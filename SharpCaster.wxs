<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">

  <Package
    Name="SharpCaster"
    Version="3.0.0"
    Manufacturer="Tapanila"
    UpgradeCode="1f0a8a1b-785c-4b2f-981c-9c36ad8f9fd3">
    <MajorUpgrade DowngradeErrorMessage="A newer version of SharpCaster is already installed." />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />
    <Icon Id="SharpCasterIcon" SourceFile="SharpCaster.ico" />
    <Property Id="ARPPRODUCTICON" Value="SharpCasterIcon" />

    <util:QueryNativeMachine />

    <Feature Id="ProductFeature" Title="SharpCaster" Level="1">
      <ComponentGroupRef Id="AppComponents" />
    </Feature>
  </Package>

  <Fragment>
    <!-- Install to native 64-bit Program Files -->
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="CompanyFolder" Name="!(bind.Property.Manufacturer)">
        <Directory Id="INSTALLFOLDER" Name="!(bind.Property.ProductName)" />
      </Directory>
    </StandardDirectory>

    <ComponentGroup Id="AppComponents" Directory="INSTALLFOLDER">
      <!-- x64 -->
      <Component Id="SharpCasterX64" Guid="*" Bitness="always64"
                Condition="WIX_NATIVE_MACHINE = 34404">
        <!-- Install with a unique name -->
        <File Id="SharpCasterExeX64"
              Name="SharpCaster.x64.exe"
              Source="sharpcaster-win-x64.exe" />
        <!-- Copy/rename to the common name -->
        <CopyFile Id="CopyX64ToCommon"
                  DestinationDirectory="INSTALLFOLDER"
                  DestinationName="SharpCaster.exe" />
        <!-- Remove the unique file after install -->
        <RemoveFile Id="CleanupX64Unique"
                    Name="SharpCaster.x64.exe"
                    On="install" />
      </Component>

      <!-- ARM64 -->
      <Component Id="SharpCasterARM64" Guid="*" Bitness="always64"
                Condition="WIX_NATIVE_MACHINE = 43620">
        <File Id="SharpCasterExeARM64"
              Name="SharpCaster.arm64.exe"
              Source="sharpcaster-win-arm.exe" />
        <CopyFile Id="CopyArmToCommon"
                  DestinationDirectory="INSTALLFOLDER"
                  DestinationName="SharpCaster.exe" />
        <RemoveFile Id="CleanupArmUnique"
                    Name="SharpCaster.arm64.exe"
                    On="install" />
      </Component>
    </ComponentGroup>
  </Fragment>
</Wix>